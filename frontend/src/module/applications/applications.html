<p-toast></p-toast>
<div class="h-full w-full bg-neutral-900 flex flex-col overflow-hidden">
  <!-- Header -->
  <div class="flex-shrink-0 px-6 py-5 border-b border-neutral-700/50 bg-gradient-to-r from-neutral-900 via-neutral-900/95 to-neutral-900">
    <div class="max-w-4xl mx-auto">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-2xl font-semibold text-white">My Applications</h1>
          <p class="text-sm text-neutral-400 mt-1">Track and manage your job applications</p>
        </div>
        <div class="flex items-center gap-3">
          <!-- Sort Dropdown -->
          <p-select
            [options]="sortOptions"
            [(ngModel)]="selectedSort"
            optionLabel="label"
            (onChange)="onSortChange()"
            styleClass="w-44 text-sm"
            appendTo="body"
          >
            <ng-template pTemplate="selectedItem" let-selected>
              <div class="flex items-center gap-1.5">
                <i class="pi pi-sort-alt text-emerald-400 text-xs"></i>
                <span class="truncate">{{ selected?.label }}</span>
              </div>
            </ng-template>
          </p-select>
          
          <div class="flex items-center gap-2 px-4 py-2 bg-neutral-800/50 rounded-lg border border-neutral-700/50">
            <i class="pi pi-briefcase text-emerald-400"></i>
            <span class="text-sm text-neutral-300">
              <span class="font-semibold text-white">{{ userApplications().length }}</span> Total
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Content Area -->
  <div class="flex-1 overflow-y-auto px-6 py-6">
    <div class="max-w-4xl mx-auto">
      <!-- Empty State -->
      @if (userApplications().length === 0) {
        <div class="flex flex-col items-center justify-center py-20 text-center">
          <div class="w-20 h-20 rounded-full bg-neutral-800 flex items-center justify-center mb-4">
            <i class="pi pi-inbox text-3xl text-neutral-500"></i>
          </div>
          <h3 class="text-lg font-medium text-white mb-2">No applications yet</h3>
          <p class="text-neutral-400 text-sm max-w-sm">Start applying to jobs and track your progress here.</p>
        </div>
      }

      <!-- Applications List -->
      @if (userApplications().length > 0) {
        <div class="flex flex-col gap-3">
          @for (item of userApplications(); track $index) {
            <div class="group bg-neutral-800/50 hover:bg-neutral-800 border border-neutral-700/50 hover:border-neutral-600 rounded-xl p-4 transition-all duration-200 cursor-pointer">
              <div class="flex items-start gap-4">
                <!-- Company Logo -->
                <div class="flex-shrink-0 w-14 h-14 rounded-lg bg-neutral-700/50 overflow-hidden flex items-center justify-center">
                  @if (item.company_logo_url) {
                    <img [src]="item.company_logo_url" [alt]="item.company" class="w-full h-full object-cover"/>
                  } @else {
                    <i class="pi pi-building text-xl text-neutral-500"></i>
                  }
                </div>

                <!-- Job Info -->
                <div class="flex-1 min-w-0">
                  <div class="flex items-start justify-between gap-4">
                    <div class="min-w-0">
                      <h3 class="font-semibold text-white truncate group-hover:text-emerald-400 transition-colors">
                        {{ item.job_title }}
                      </h3>
                      <p class="text-sm text-neutral-400 mt-0.5">{{ item.company }}</p>
                      
                      <!-- Location & Date -->
                      <div class="flex items-center gap-3 mt-2 text-xs text-neutral-500">
                        @if (item.job_city || item.job_country) {
                          <span class="flex items-center gap-1">
                            <i class="pi pi-map-marker"></i>
                            {{ item.job_city }}{{ item.job_city && item.job_country ? ', ' : '' }}{{ item.job_country }}
                          </span>
                        }
                        @if (item.date) {
                          <span class="flex items-center gap-1">
                            <i class="pi pi-calendar"></i>
                            Applied {{ item.date | date:'mediumDate' }}
                          </span>
                        }
                        @if (item.portal) {
                          <span class="flex items-center gap-1">
                            <i class="pi pi-external-link"></i>
                            via {{ item.portal }}
                          </span>
                        }
                      </div>
                    </div>

                    <!-- Status Badge -->
                    <div class="flex-shrink-0">
                      @switch (item.status) {
                        @case ('APPLIED') {
                          <span class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-blue-500/20 text-blue-400 border border-blue-500/30">
                            <span class="w-1.5 h-1.5 rounded-full bg-blue-400"></span>
                            Applied
                          </span>
                        }
                        @case ('INTERVIEW_SCHEDULED') {
                          <span class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-amber-500/20 text-amber-400 border border-amber-500/30">
                            <span class="w-1.5 h-1.5 rounded-full bg-amber-400"></span>
                            Interview
                          </span>
                        }
                        @case ('ACCEPTED') {
                          <span class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-emerald-500/20 text-emerald-400 border border-emerald-500/30">
                            <span class="w-1.5 h-1.5 rounded-full bg-emerald-400"></span>
                            Accepted
                          </span>
                        }
                        @case ('REJECTED') {
                          <span class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-red-500/20 text-red-400 border border-red-500/30">
                            <span class="w-1.5 h-1.5 rounded-full bg-red-400"></span>
                            Rejected
                          </span>
                        }
                        @default {
                          <span class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-neutral-700/50 text-neutral-400 border border-neutral-600/50">
                            <span class="w-1.5 h-1.5 rounded-full bg-neutral-400"></span>
                            {{ item.status }}
                          </span>
                        }
                      }
                    </div>
                  </div>

                  <!-- Notes Preview -->
                  @if (item.notes) {
                    <p class="mt-3 text-sm text-neutral-500 line-clamp-2 border-t border-neutral-700/50 pt-3">
                      <i class="pi pi-comment text-xs mr-1.5"></i>{{ item.notes }}
                    </p>
                  }
                </div>

                <!-- Actions -->
                <div class="flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity">
                  <button class="p-2 text-neutral-400 hover:text-white hover:bg-neutral-700 rounded-lg transition-colors">
                    <i class="pi pi-ellipsis-v"></i>
                  </button>
                </div>
              </div>
            </div>
          }
        </div>
      }
    </div>
  </div>
</div>